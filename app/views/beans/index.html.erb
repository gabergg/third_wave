<% provide(:title, 'Beans') %>

<h1>Beans</h1>

<div class="row">

  <div class="span6 offset1">
    <table>
      <tr>
        <th>Roaster</th>
        <th>Bean</th>
        <th>Roast</th>
        <th>Origin</th>
        <th>Avg Rating</th>
        <th></th>
        <th></th>
      </tr>

      <% @beans.each do |bean| %>
          <tr>
            <td><%= link_to bean.roaster.name, bean.roaster %></td>
            <td><%= link_to bean.name, bean %></td>
            <td><%= bean.roast %></td>
            <td><%= bean.origin %></td>
            <td><%= bean.avg_rating != "None" ? bean.avg_rating.round(2) : "None" %></td>
            <% if signed_in? %>
                <td><%= link_to "Rate", new_review_path(:bean_id => bean.id) %></td>
            <% end %>
            <% if current_user && current_user.admin? %>
                <td><%= link_to "Remove", bean, method: :delete, data: {confirm: "Are you sure?"} %></td>
            <% end %>
          </tr>
      <% end %>
    </table>
    <%= will_paginate @beans %>

  </div>

  <div class="span4">
    <%= button_tag "Add a bean", type: "button", onclick: "$('#new-bean-form').toggle()",
                   class: "btn btn-small btn-primary" %>

    <%= render 'shared/new_bean_form' %>
    <script>if($('.alert-error').text()) $('#new-bean-form').show()</script>
  </div>

</div>

<script>init_auto_roaster()</script>